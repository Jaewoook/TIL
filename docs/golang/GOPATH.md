# GOPATH

Go 언어를 배우면서 햇갈리는 것 중에 하나가 **GOPATH** 라는 녀석이었다.
처음에는 단순히 그냥 Environment Variable 로 PATH 잘 잡아주면 끝인 줄 알았는데, **단일 Workspace** 로 개발을 해야 한다는 강제성 때문에 이걸 무조건 **GOPATH** 라는 이름으로 (난 처음에 GOPATH 가 띄어쓰기가 없어서 GO_PATH 로 설정했었음) 환경변수 등록을 해줘야 한다.
GOPATH 말고도 GOROOT 처럼 **GO\*** 로 시작하는 이런저런 변수가 있다. 물론 설정을 안하면 Go runtime 에 있는 기본값으로 돌아가는 모양이다.

## 단일 Workspace

GOPATH 를 설정해야 하는 이유중에 단일 Workspace 로 개발해야 돼서 설정해줘야 한다고 했다. 더 자세히 말하자면, Go 로 코딩을 하다가 외부 라이브러리나 바이너리 등을 갖다가 쓰려면 그런 바이너리들이나 라이브러리들이 저장되는 PATH 가 필요하고, (왜? 모든 프로젝트에서 이것들을 공유하는 구조로 설계되었기 때문.) 심지어 로컬 패키지나 서브 패키지를 import 하기 위해서도 GOPATH 를 설정해 줌으로써 어느 경로로부터 참조해야 하는지 알 수 있기 때문이다.

그래서 Go 를 배우기 전까지 거의 JavaScript, TypeScript 코드를 짜던 나는, npm 패키지 구조에서 단일 워크스페이스 구조를 적응해야만 했었다. 사실 이 부분에서 왜 그렇게 해야하는지 이해를 할 수 없었고, 아직도 살짝 이해가 안되고, 관련 내용을 찾아보느라 여러 글을 읽어보며 시간을 썼던 것 같다. 그리고 알게 된 것은, **꼭 단일 워크스페이스 구조가 아니어도 된다는 것...** 그런데 너무 늦게 알아서 일단은 GOPATH 와 단일 Workspace 에 대해 많이 알아버렸다. 그래도 아직까지 단일 워크스페이스가 쓰이는 곳이 많은 것 같다.

### Go 환경변수 확인

Go runtime 에 어떤 환경변수가 존재하고, 무엇을 컨트룰 할 수 있는지는 공식 문서를 봐도 되고, 커맨드로 설정한 환경변수가 잘 들어가 있는지 확인할수도 있다.

```sh
go env
```

위와 같은 명령어를 입력하면 Go runtime 에서 사용되는 여러가지 환경변수가 나온다.

## GOPATH의 적절한 위치?

여러 튜토리얼에서는 GOPATH 를 `$HOME/go` 같은 곳에 설정하길 권장하고 있다. 내가 처음 본 글에서는 `$HOME/.go` 폴더에 설정하라고 해서 나는 GOPATH 가 라이브러리가 저장되는 캐시 폴더 정도로 생각했는데 위에 말했듯이 사실 그런 폴더는 아니었고, 보통 나는 `$HOME/projects` 나 `$HOME/work` 같은 작업폴더 아래 모든 프로젝트를 모아놓는 습관이 있어서 최종적으로 `$HOME/projects/goprojects` 라는 폴더를 GOPATH 로 설정했다. 이렇게 하니 Go 로 작성된 프로젝트, 모듈들은 전부 `$HOME/projects/goprojects` 아래에 모이는 구조가 돼서 그냥저냥 타협을 보고 살기로 결정했다.

## Go Workspace 구조

GOPATH 를 설정해 Workspace 가 어디에 있는지 설정해주면, 그 경로 아래에서 코딩하면 된다. Go 에서는 생각보다 미리 강제된게 많은데, 이게 어떻게 보면 미리 정해져있어서 이대로만 잘 써준다면 좋은 것 같고, 고민 안해도 되서 좋은 것 같다.

Workspace 구조는 아래와 같이 이루어져 있다.

```
|- Workspace root
|-- bin
|-- pkg
|-- src
```

bin 은 실행 가능한 바이너리가 들어가고, pkg 는 패키지 관련 파일이 있다고 한다. 마지막으로 src 아래에 Java 의 패키지 같이 url 을 거꾸로 한 형태의 폴더 구조로 소스 파일이 들어간다. (ex. com.github.com/Jaewoook/sample)

### Sample package structure

```
|- src
|-- com.github
|--- Jaewoook
|---- sample
|----- sample.go // source here
|----- sub_package
```

## 외부 의존성 설치하기

외부 라이브러리나 바이너리 등을 설치하는 것은 간단하다.

```
go get github.com/some/go/module
```

이런 커맨드로 쉽게 외부 의존성을 설치할 수 있다.
이렇게 하면 외부 바이너리나 라이브러리 등이 적절하게 bin, pkg, src 안에 다운받아지게 된다.

## 외부 의존성 import 하기

외부 의존성 import 는 npm 기반 프로젝트를 하던 나에게는 신기했는데, url 기반으로 패키지를 import 했다. 글을 쓰면서 생각해보니 Java 도 이런식으로 import 했었구나 라는 생각이 든다.

### Sample import

```go
import github.com/Jaewoook/sample-pkg
```

## 내 생각

GOPATH 와 단일 Workspace 를 배우면서, npm 프로젝트와는 일단 많이 달라서 어색하긴 했다. 그러면서 Python 의 전역 environment 와 비슷하다는 생각도 들었고, 한번 모듈을 설치하면 모든 프로젝트에서 공유한다는 컨셉도 신기했다. 심지어 vscode 위에서 개발하는데 vscode go plugin 들도 이 workspace 에 설치되는걸 보고 신기했었다. 하지만, 코드를 작성하고 배포할 때, 의존성 버전 이슈가 있을 수 있겠구나 라는 생각이 들면서 여러 패키지간에 같은 라이브러리이지만 다른 버전을 쓸 경우엔 어떻게 하지? 라는 생각도 들고, 아직 내가 겉핥기 수준으로 Go 를 배우고 있어서 뭐만 하면 막히기 일쑤였다. 그래서 아직 배울게 한참 많이 남았다라는 생각이 들었다.